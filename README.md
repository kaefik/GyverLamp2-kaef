# GyverLamp2-kaef 
это форк оригинального проекта GyverLamp2 от AlexGyver
![Logo](/docs/banner2.png)

--------------
## Прошивка NodeMCU v.1.0
* Инструменты / Плата NodeMCU 1.0 (ESP-12E Module) в оригинальном проекте была рекомендация выбирать плату "Плата Generic ESP8266", но у меня не прошилось
* Инструменты / Flash Size 4MB (FS:2MB OTA)
* CPU Frequency / 160 MHz (рекомендуется для стабильности светомузыки!!!)
* При прошивке с других прошивок лампы поставить: Инструменты/Erase Flash/All Flash Contents
* ESP core 2.7.4+ http://arduino.esp8266.com/stable/package_esp8266com_index.json
* FastLED 3.4.0+ https://github.com/FastLED/FastLED/releases

---------------

## Настройка матрицы в прошивке

файл data.h структура:

```
struct Config {
  byte bright = 100;      // яркость
  byte adcMode = 1;       // режим ацп (1 выкл, 2 ярк, 3 муз)
  byte minBright = 0;     // мин яркость
  byte maxBright = 255;   // макс яркость
  byte rotation = 0;      // смена режимов: 0 ручная, 1 авто
  byte rotRnd = 0;        // тип автосмены: 0 в порядке, 1 рандом
  byte rotPeriod = 1;     // период смены (1,5..)
  byte deviceType = 2;    // 1 лента, 2 зигзаг, 3 параллел
  byte maxCur = 5;        // макс ток (мА/100)
  byte workFrom = 0;      // часы работы (0,1.. 23)
  byte workTo = 0;        // часы работы (0,1.. 23)
  byte matrix = 1;        // тип матрицы 1.. 8

```

config.matrix используется в функции getPix(int x, int y) для доступа к конкретному пикселю в зависимости от расположения матрицы

## Отличия от первой версии GyverLamp:
- Возможность объединять устройства в группы с синхронизированными эффектами и их автоматическим переключением
- Возможность создать свой список режимов для каждой группы устройств
- Конструктор режимов, позволяющий получить несколько сотен уникальных эффектов
- Минимум настроек в прошивке, всё настраивается из приложения
- Гибкие настройки сети, позволяющие на лету менять точки подключения, адресацию и роли
- Светомузыка - реакция на звук может быть наложена на любой эффект несколькими способами
- Адаптивная яркость благодаря датчику освещённости
- Режим работы по расписанию и таймер выключения для группы устройств
- Мультиязычное приложение со встроенными инструкциями и подсказками
- Простая и удобная загрузка прошивки (скомпилированный файл), прошивка возможна даже со смартфона!
- Обновление прошивки «по воздуху» из приложения (требуется подключение к Интернет)
- Схема как у первой версии, перепаивать электронику не нужно (без учёта микрофона и датчика освещённости)
- Автоматическое определение типа кнопки
- Устройство может работать без кнопки, все важные настройки можно сделать с приложения

Сеть:
- Работа в локальной сети роутера (все устройства подключаются к роутеру)
- Работа в локальной сети одной лампы (все устройства подключаются к одной лампе)

Время:
- Устройства подключаются к Интернету через роутер и запрашивают текущее время
- Работа по расписанию: час включения и час выключения
- Таймер выключения
- Будильник-рассвет на каждый день недели

Тип устройства:
- GyverLamp2 может работать как с лентами, так и с матрицами различной конструкции

Адресация:
- Объединение устройств в группы с индивидуальным набором настроек и режимов
- Роли Master и Slave: состояние и яркость Slave устройств подчиняется Master устройству при ручном управлении

Режимы:
- Каждой группе может быть задан свой набор режимов работы
- Режим представляет собой эффект и его настройки (сам эффект, реакция на звук, яркость, скорость и т.д.)
- Ручное переключение режимов кнопкой или из приложения (для всех устройств в группе)
- Автоматическое по порядку с установленным периодом (для всех устройств в группе)
- Автоматическое в случайном порядке с установленным периодом (для всех устройств в группе)
- Режимы синхронизированы: все устройства группы показывают один и тот же режим в любой момент времени

Эффекты:
- 7 базовых эффектов, у каждого есть индивидуальные настройки
- У некоторых эффектов возможен выбор цветовой палитры из 25 доступных
- Эффекты синхронизированы у всех устройств в группе

Реакция на звук:
- При подключении микрофона все режимы могут работать как светомузыка
- Реакция на общую громкость, отдельно низкие и отдельно высокие частоты
- Реакция на звук может менять яркость режима, а также некоторые настройки эффекта

Автоматическая яркость:
- Есть возможность подключить датчик освещённости для автоматической настройки яркости лампы

Будильник-рассвет:
- Подключенная к роутеру группа может будить в установленное время плавным рассветом
- Можно настроить время конкретные дни недели, а также яркость рассвета